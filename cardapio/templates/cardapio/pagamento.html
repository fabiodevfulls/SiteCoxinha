{% extends 'cardapio/base.html' %}
{% load static %}

{% block content %}
<div class="container mt-5">
    <div class="row">
        <!-- Coluna do Pagamento -->
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-danger text-white">
                    <h4 class="mb-0">Pagamento via Mercado Pago</h4>
                </div>
                <div class="card-body">
                    <!-- Container para o botão do Mercado Pago -->
                    <div id="payment-container" class="text-center py-4">
                        <div class="spinner-border text-danger" role="status">
                            <span class="visually-hidden">Carregando...</span>
                        </div>
                    </div>
                    
                    <!-- Aviso de Segurança -->
                    <div class="alert alert-info mt-4">
                        <i class="bi bi-shield-lock"></i>
                        Pagamento processado com segurança pelo Mercado Pago
                    </div>
                </div>
            </div>
        </div>

        <!-- Coluna do Resumo -->
        <div class="col-md-4 mt-4 mt-md-0">
            <div class="card">
                <div class="card-header bg-danger text-white">
                    <h5 class="mb-0">Resumo do Pedido</h5>
                </div>
                <div class="card-body">
                    {% for item in carrinho %}
                    <div class="d-flex justify-content-between mb-2">
                        <span>{{ item.produto.nome }} x{{ item.quantidade }}</span>
                        <span>R$ {{ item.subtotal }}</span>
                    </div>
                    {% endfor %}
                    
                    <hr>
                    <div class="d-flex justify-content-between fw-bold">
                        <span>Total:</span>
                        <span>R$ {{ total }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- SDK Mercado Pago -->
<script src="https://sdk.mercadopago.com/js/v2"></script>
<script>
    // Configuração do Mercado Pago
    const mp = new MercadoPago('{{ MERCADOPAGO_PUBLIC_KEY }}', {
        locale: 'pt-BR'
    });

    // Inicializar checkout
    mp.checkout({
        preference: {
            id: '{{ preference_id }}'  // ID da preferência gerada
        },
        render: {
            container: '#payment-container', // Elemento onde o botão será renderizado
            label: 'Pagar Agora', // Texto do botão
            type: 'wallet', // Tipo de checkout
            theme: 'flat',  // Estilo do botão
            customization: {
                variable: {
                    paymentMethods: {
                        atm: 'all',
                        bankTransfer: 'all',
                        ticket: 'all',
                        creditCard: 'all',
                        debitCard: 'all',
                        walletPurchase: 'all'
                    }
                }
            }
        }
    });
</script>

<style>
    /* Customizações visuais */
    #payment-container {
        min-height: 200px;
    }
    
    .mercadopago-button {
        background-color: #dc3545 !important;
        border-color: #dc3545 !important;
        padding: 12px 24px !important;
        font-size: 1.1rem !important;
        border-radius: 8px !important;
    }
    
    .mercadopago-button:hover {
        background-color: #bb2d3b !important;
    }
</style>
{% endblock %}